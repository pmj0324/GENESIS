# ğŸ‰ GENESIS - GPU ìµœì í™” ì™„ë£Œ!

ëª¨ë“  ê¸°ëŠ¥ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë‹¹ì‹ ì˜ í•˜ë“œì›¨ì–´ì— ë§ëŠ” ìµœì  ì„¤ì •ì„ ìë™ìœ¼ë¡œ ì°¾ê³  ë°”ë¡œ í•™ìŠµì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

---

## ğŸ“‹ ì™„ì„±ëœ ê¸°ëŠ¥ ëª©ë¡

### âœ… í•µì‹¬ ê¸°ëŠ¥
1. **GPU ì •ë³´ ìë™ ì¶œë ¥** - GPU ì´ë¦„, ë©”ëª¨ë¦¬, CUDA ë²„ì „, ê°œìˆ˜
2. **Step ìë™ ê³„ì‚°** - Steps/epoch, Total steps, Warmup steps (4% ê¸°ë°˜)
3. **Per-sample ë©”ëª¨ë¦¬ ì •í™•í•œ ê³„ì‚°** - ì…ë ¥ ë°ì´í„° + Activation ìƒì„¸ ë¶„ì„
4. **CLI ì¸ì ì˜¤ë²„ë¼ì´ë“œ** - `--batch-size`, `--lr`, `--epochs`, `--num-workers`
5. **ì²« ë°°ì¹˜ í†µê³„ ìƒ˜í”Œë§** - ë°°ì¹˜ í¬ê¸° ë¬´ê´€í•˜ê²Œ 128ê°œë§Œ ìƒ˜í”Œë§ (íš¨ìœ¨)
6. **ì¡°ê¸° ì¢…ë£Œ (Early Stopping)** - 4 epoch patience ê¸°ë³¸ê°’

### âœ… GPU ë²¤ì¹˜ë§ˆí‚¹ ë° ìë™ ìµœì í™” â­
7. **ìë™ ë²¤ì¹˜ë§ˆí¬** - ë°°ì¹˜ í¬ê¸° 1~8192 ìë™ í…ŒìŠ¤íŠ¸
8. **ìƒì„¸ ì„±ëŠ¥ ì¸¡ì •** - I/O, Forward, Backward, Optimizer ì‹œê°„ ê°œë³„ ì¸¡ì •
9. **GPU ì‚¬ìš©ë¥  ì¶”ì ** - ì‹¤ì‹œê°„ GPU í™œìš©ë„ ë° ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§
10. **OOM ìë™ ê°ì§€** - Out of Memory ìë™ ê°ì§€ ë° ì¤‘ë‹¨
11. **ìµœì  ì„¤ì • YAML ìë™ ìƒì„±** â­ - ë‹¹ì‹ ì˜ í•˜ë“œì›¨ì–´ì— ë”± ë§ëŠ” ì„¤ì •!
12. **Learning Rate ìë™ ê³„ì‚°** - Sqrt scaling rule ì ìš©
13. **DataLoader ì˜µì…˜ ìë™ ìµœì í™”** - pin_memory, channel_first, use_amp ë“±

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘ (2ë‹¨ê³„!)

### Step 1: GPU ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰ (10ë¶„, í•œ ë²ˆë§Œ)

```bash
cd ~/GENESIS/GENESIS-pmj0324/GENESIS
git pull
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null

python scripts/analysis/benchmark_gpu.py \
    --config configs/checking_gpu_optimization.yaml \
    --data-path /home/work/GENESIS/GENESIS-data/22644_0921_time_shift.h5
```

**ê²°ê³¼:**
- ì—¬ëŸ¬ ë°°ì¹˜ í¬ê¸° ìë™ í…ŒìŠ¤íŠ¸ (1, 2, 4, 8, ..., 8192)
- ê° ì„¤ì •ì˜ ì„±ëŠ¥ ì¸¡ì • (Throughput, GPU ì‚¬ìš©ë¥ , ë©”ëª¨ë¦¬)
- **`configs/optimized_by_benchmark.yaml` ìë™ ìƒì„±!** â­

### Step 2: ìµœì  ì„¤ì •ìœ¼ë¡œ ë°”ë¡œ í•™ìŠµ!

```bash
python scripts/train.py \
    --config configs/optimized_by_benchmark.yaml \
    --data-path /home/work/GENESIS/GENESIS-data/22644_0921_time_shift.h5
```

**ë!** ì¶”ê°€ ì„¤ì • ë¶ˆí•„ìš”! ğŸ‰

---

## ğŸ“Š ìë™ ìƒì„±ë˜ëŠ” ìµœì  ì„¤ì • ì˜ˆì‹œ

```yaml
# Optimized Configuration
# ======================
# Generated by benchmark_gpu.py on 2024-10-10 22:30:15
#
# Benchmark Results:
#   Batch Size:     4096
#   Workers:        12
#   Throughput:     4447.8 samples/sec
#   GPU Memory:     27.85 GB
#   GPU Util:       93.8%
#   I/O Time:       35.67 ms
#   Forward Time:   367.89 ms
#   Backward Time:  518.45 ms
#
# This configuration is optimized for your specific hardware!

experiment_name: optimized_by_benchmark
description: Automatically optimized configuration...

model:
  # ... (ëª¨ë“  ëª¨ë¸ ì„¤ì • ë³µì‚¬)

data:
  batch_size: 4096          # â† ë²¤ì¹˜ë§ˆí¬ë¡œ ì°¾ì€ ìµœì ê°’!
  num_workers: 12           # â† ë²¤ì¹˜ë§ˆí¬ë¡œ ì°¾ì€ ìµœì ê°’!
  pin_memory: true          # â† ìë™ ìµœì í™”!
  channel_first: true       # â† PyTorch í‘œì¤€!
  shuffle: true             # â† í•™ìŠµìš© ìë™ ì„¤ì •!

training:
  learning_rate: 0.000566   # â† Sqrt scalingìœ¼ë¡œ ìë™ ê³„ì‚°!
  use_amp: true             # â† í•„ìˆ˜ ìµœì í™”!
  # ... (ê¸°íƒ€ ì„¤ì •)
```

---

## ğŸ¯ ìë™ ìµœì í™” í•­ëª©

| í•­ëª© | ê¸°ë³¸ê°’ | ìµœì í™” ë°©ë²• | ì˜ˆì‹œ |
|------|--------|------------|------|
| `batch_size` | 128 | ë²¤ì¹˜ë§ˆí¬ ì¸¡ì • | 4096 |
| `num_workers` | 4 | ë²¤ì¹˜ë§ˆí¬ ì¸¡ì • | 12 |
| `learning_rate` | 1e-4 | Sqrt scaling | 5.66e-4 |
| `pin_memory` | ? | GPU ì‚¬ìš©ì‹œ ìë™ | True |
| `channel_first` | ? | PyTorch í‘œì¤€ | True |
| `use_amp` | ? | í•„ìˆ˜ ìµœì í™” | True |
| `shuffle` | ? | í•™ìŠµìš© ìë™ | True |

**ê³µì‹:** `lr_new = lr_base Ã— âˆš(batch_new / batch_base)`
- ì˜ˆ: `1e-4 Ã— âˆš(4096/128) = 1e-4 Ã— 5.66 = 5.66e-4`

---

## ğŸ“ˆ ì˜ˆìƒ ì„±ëŠ¥ í–¥ìƒ

### Before (ìˆ˜ë™ ì„¤ì •)
```
Batch: 128
Workers: 4
Learning Rate: 1e-4 (ì¶”ì¸¡)

â†’ Epoch ì‹œê°„: ~15ë¶„
â†’ 100 epochs: ~25ì‹œê°„
```

### After (ìë™ ìµœì í™”)
```
Batch: 4096 (ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼)
Workers: 12 (ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼)
Learning Rate: 5.66e-4 (ìë™ ê³„ì‚°)

â†’ Epoch ì‹œê°„: ~1ë¶„
â†’ 100 epochs: ~2ì‹œê°„
```

**ì†ë„ í–¥ìƒ: 12-15ë°°!** ğŸš€

---

## ğŸ“š ë¬¸ì„œ êµ¬ì¡°

### ì£¼ìš” ë¬¸ì„œ (`docs/`)
- **`GPU_BENCHMARK_GUIDE.md`** â­ - GPU ë²¤ì¹˜ë§ˆí¬ ë„êµ¬ ì™„ì „ ê°€ì´ë“œ
- **`GPU_MEMORY_GUIDE.md`** - GPU ë©”ëª¨ë¦¬ ë¶„ì„ ë° ë°°ì¹˜ í¬ê¸° ì¶”ì²œ
- **`MAX_GPU_GUIDE.md`** - GPU ìµœëŒ€ í™œìš© ì „ëµ
- **`GETTING_STARTED.md`** - í™˜ê²½ ì„¤ì • ë° ì‹œì‘ ê°€ì´ë“œ
- **`TRAINING.md`** - í•™ìŠµ ê°€ì´ë“œ (Early stopping, Schedulers ë“±)
- **`NORMALIZATION_FINAL.md`** - ì •ê·œí™” ì„¤ì • ê°€ì´ë“œ
- **`DIFFUSION_MODULE.md`** - Diffusion ëª¨ë“ˆ êµ¬ì¡°

### ì•„ì¹´ì´ë¸Œ (`docs/archive/`)
ì„ì‹œ ë° ì¤‘ë³µ ë¬¸ì„œë“¤ì´ ì •ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ”§ ì£¼ìš” ì„¤ì • íŒŒì¼

### í•™ìŠµìš© ì„¤ì •
- **`configs/default.yaml`** - ê¸°ë³¸ ì„¤ì • (ì•ˆì •ì )
- **`configs/max_gpu.yaml`** - GPU ìµœëŒ€ í™œìš© (ë¹ ë¦„)
- **`configs/optimized_by_benchmark.yaml`** â­ - ë²¤ì¹˜ë§ˆí¬ ìë™ ìƒì„± (ìµœì !)

### ë²¤ì¹˜ë§ˆí¬ìš© ì„¤ì •
- **`configs/checking_gpu_optimization.yaml`** - ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰ìš©

### ê¸°íƒ€ ì„¤ì •
- `configs/debug.yaml` - ë¹ ë¥¸ ë””ë²„ê¹…
- `configs/cnn.yaml`, `configs/hybrid.yaml` ë“± - ë‹¤ë¥¸ ì•„í‚¤í…ì²˜

---

## ğŸ’¡ DataLoader ì˜µì…˜ ì„¤ëª…

### `pin_memory` (True ê¶Œì¥)
- **ê¸°ëŠ¥**: CPU â†’ GPU ë°ì´í„° ì „ì†¡ 2-3ë°° ë¹ ë¥´ê²Œ
- **ì‘ë™**: DMA(Direct Memory Access) ì‚¬ìš©
- **ê¶Œì¥**: GPU ì‚¬ìš©ì‹œ í•„ìˆ˜ True

### `num_workers` (8-12 ê¶Œì¥)
- **ê¸°ëŠ¥**: ë°ì´í„° ë¡œë”© ë³‘ë ¬í™”
- **ì‘ë™**: ë³„ë„ í”„ë¡œì„¸ìŠ¤ì—ì„œ ë°ì´í„° ë¯¸ë¦¬ ì¤€ë¹„
- **ê¶Œì¥**: CPU ì½”ì–´ ìˆ˜ ê³ ë ¤ (ë³´í†µ 8-12)

### `channel_first` (True ê¶Œì¥)
- **ê¸°ëŠ¥**: ë°ì´í„° ì°¨ì› ìˆœì„œ ê²°ì •
- **PyTorch**: `(Batch, Channels, Length)` = `(B, 2, 5160)`
- **ê¶Œì¥**: PyTorch í‘œì¤€ True

### `shuffle` (í•™ìŠµì‹œ True)
- **ê¸°ëŠ¥**: ë§¤ epochë§ˆë‹¤ ë°ì´í„° ìˆœì„œ ì„ê¸°
- **íš¨ê³¼**: ì¼ë°˜í™” ì„±ëŠ¥ í–¥ìƒ
- **ê¶Œì¥**: í•™ìŠµ True, ê²€ì¦/í…ŒìŠ¤íŠ¸ False

### `use_amp` (True ê¶Œì¥)
- **ê¸°ëŠ¥**: Mixed Precision Training (float16)
- **íš¨ê³¼**: ì†ë„ 2-3ë°°, ë©”ëª¨ë¦¬ ì ˆì•½ 50%
- **ê¶Œì¥**: í•„ìˆ˜ True

---

## ğŸ¯ ì‹¤ì „ ì›Œí¬í”Œë¡œìš°

### 1. ì²˜ìŒ ì„œë²„ì—ì„œ (10ë¶„, í•œ ë²ˆë§Œ)

```bash
# ì €ì¥ì†Œ í´ë¡  ë° í™˜ê²½ ì„¤ì • (ì´ë¯¸ ì™„ë£Œ)
cd ~/GENESIS/GENESIS-pmj0324/GENESIS
git pull

# GPU ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰
python scripts/analysis/benchmark_gpu.py \
    --config configs/checking_gpu_optimization.yaml \
    --data-path /home/work/GENESIS/GENESIS-data/22644_0921_time_shift.h5

# â†’ configs/optimized_by_benchmark.yaml ìƒì„±ë¨!
```

### 2. ë³¸ í•™ìŠµ

```bash
# ìë™ ìƒì„±ëœ ìµœì  ì„¤ì •ìœ¼ë¡œ í•™ìŠµ
python scripts/train.py \
    --config configs/optimized_by_benchmark.yaml \
    --data-path /home/work/GENESIS/GENESIS-data/22644_0921_time_shift.h5
```

### 3. í•™ìŠµ ì¤‘ ëª¨ë‹ˆí„°ë§

```bash
# ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ
watch -n 1 nvidia-smi

# TensorBoard (ì„ íƒ)
tensorboard --logdir ./logs
```

---

## ğŸ” ë¬¸ì œ í•´ê²°

### OOM (Out of Memory)
```bash
# ë°°ì¹˜ í¬ê¸° ì¤„ì´ê¸°
python scripts/train.py \
    --config configs/optimized_by_benchmark.yaml \
    --batch-size 2048 \
    --data-path /path/to/data.h5
```

### ëŠë¦° í•™ìŠµ
```bash
# ë²¤ì¹˜ë§ˆí¬ ì¬ì‹¤í–‰ (Workers ìˆ˜ ì¡°ì •)
python scripts/analysis/benchmark_gpu.py \
    --config configs/checking_gpu_optimization.yaml \
    --data-path /path/to/data.h5 \
    --batch-sizes 2048 4096 \
    --num-workers 8 12 16
```

### GPU ì‚¬ìš©ë¥  ë‚®ìŒ (<70%)
```
ì›ì¸: I/O ë³‘ëª©
í•´ê²°: num_workers ì¦ê°€ (4 â†’ 8 â†’ 12)
```

---

## ğŸ“Š ë²¤ì¹˜ë§ˆí¬ ì¸¡ì • í•­ëª©

1. **I/O Time** - ë°ì´í„° ë¡œë”© ì‹œê°„ (ë””ìŠ¤í¬ â†’ ë©”ëª¨ë¦¬)
2. **Forward Time** - ìˆœì „íŒŒ ê³„ì‚° ì‹œê°„
3. **Backward Time** - ì—­ì „íŒŒ ê·¸ë˜ë””ì–¸íŠ¸ ê³„ì‚° ì‹œê°„
4. **Optimizer Time** - ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸ ì‹œê°„
5. **Throughput** - ì´ˆë‹¹ ì²˜ë¦¬ ìƒ˜í”Œ ìˆ˜ (ëª©í‘œ: ìµœëŒ€í™”!)
6. **GPU Utilization** - GPU ê³„ì‚° ìœ ë‹› í™œìš©ë„ (ì´ìƒì : 70-95%)
7. **GPU Memory** - ì‹¤ì œ ì‚¬ìš© ë©”ëª¨ë¦¬ (ì´ìƒì : 50-70%)

---

## ğŸ‰ ì™„ì„±ëœ íŒŒì¼ êµ¬ì¡°

```
GENESIS/
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ default.yaml
â”‚   â”œâ”€â”€ max_gpu.yaml
â”‚   â”œâ”€â”€ checking_gpu_optimization.yaml      # ë²¤ì¹˜ë§ˆí¬ìš©
â”‚   â””â”€â”€ optimized_by_benchmark.yaml         # ìë™ ìƒì„±! â­
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ train.py                            # í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ sample.py                           # ìƒ˜í”Œë§ ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ analysis/
â”‚       â”œâ”€â”€ benchmark_gpu.py                # GPU ë²¤ì¹˜ë§ˆí¬ â­
â”‚       â””â”€â”€ check_gpu_memory.py             # GPU ë©”ëª¨ë¦¬ ì²´í¬
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ GPU_BENCHMARK_GUIDE.md              # ë²¤ì¹˜ë§ˆí¬ ê°€ì´ë“œ â­
â”‚   â”œâ”€â”€ GPU_MEMORY_GUIDE.md
â”‚   â”œâ”€â”€ MAX_GPU_GUIDE.md
â”‚   â”œâ”€â”€ GETTING_STARTED.md
â”‚   â”œâ”€â”€ TRAINING.md
â”‚   â””â”€â”€ archive/                            # ì„ì‹œ ë¬¸ì„œë“¤
â”‚
â”œâ”€â”€ models/                                  # ëª¨ë¸ ì •ì˜
â”œâ”€â”€ dataloader/                              # ë°ì´í„° ë¡œë”
â”œâ”€â”€ training/                                # í•™ìŠµ ë¡œì§
â”œâ”€â”€ diffusion/                               # Diffusion ëª¨ë“ˆ
â”œâ”€â”€ utils/                                   # ìœ í‹¸ë¦¬í‹°
â”‚
â””â”€â”€ FINAL_SETUP_COMPLETE.md                 # ì´ íŒŒì¼!
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

í•™ìŠµ ì‹œì‘ ì „ í™•ì¸:
- [ ] Git pull ì™„ë£Œ
- [ ] ìºì‹œ ì •ë¦¬ (`__pycache__` ì‚­ì œ)
- [ ] GPU ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰ ì™„ë£Œ
- [ ] `configs/optimized_by_benchmark.yaml` ìƒì„± í™•ì¸
- [ ] ë°ì´í„° ê²½ë¡œ í™•ì¸
- [ ] GPU ì‚¬ìš© ê°€ëŠ¥ í™•ì¸ (`nvidia-smi`)

---

## ğŸš€ ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘!

```bash
cd ~/GENESIS/GENESIS-pmj0324/GENESIS
git pull
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null

# 1. ë²¤ì¹˜ë§ˆí¬ (10ë¶„)
python scripts/analysis/benchmark_gpu.py \
    --config configs/checking_gpu_optimization.yaml \
    --data-path /home/work/GENESIS/GENESIS-data/22644_0921_time_shift.h5

# 2. í•™ìŠµ ì‹œì‘!
python scripts/train.py \
    --config configs/optimized_by_benchmark.yaml \
    --data-path /home/work/GENESIS/GENESIS-data/22644_0921_time_shift.h5
```

**ë‹¹ì‹ ì˜ í•˜ë“œì›¨ì–´ì— ìµœì í™”ëœ ì„¤ì •ìœ¼ë¡œ ìµœëŒ€ ì†ë„ë¡œ í•™ìŠµí•˜ì„¸ìš”!** ğŸ‰ğŸš€

---

## ğŸ“ ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?

- GPU ë²¤ì¹˜ë§ˆí¬: `docs/GPU_BENCHMARK_GUIDE.md`
- ë©”ëª¨ë¦¬ ë¬¸ì œ: `docs/GPU_MEMORY_GUIDE.md`
- ì‹œì‘ ê°€ì´ë“œ: `docs/GETTING_STARTED.md`
- í•™ìŠµ ê°€ì´ë“œ: `docs/TRAINING.md`

Happy training! ğŸ‰

